# การทำงานของ `app.js`

ไฟล์ `app.js` เป็นไฟล์ JavaScript ที่จัดการตรรกะฝั่งไคลเอ็นต์สำหรับส่วนความคิดเห็น (comment section) ของหน้าเว็บ

นี่คือรายละเอียดการทำงานของมัน:

1.  **`DOMContentLoaded` Event Listener**: ตรวจสอบให้แน่ใจว่าสคริปต์จะทำงานหลังจากที่เอกสาร HTML ทั้งหมดถูกโหลดและแยกวิเคราะห์เรียบร้อยแล้วเท่านั้น

2.  **การเลือก Element**: มันจะอ้างอิงถึงองค์ประกอบ HTML ต่างๆ เช่น คอนเทนเนอร์ความคิดเห็น (comments container), ฟอร์มความคิดเห็น (comment form), ช่องป้อนชื่อ (name input) และช่องป้อนความคิดเห็น (comment input)

3.  **ฟังก์ชัน `sanitize`**: ฟังก์ชันนี้มีวัตถุประสงค์เพื่อทำความสะอาดข้อมูลที่ผู้ใช้ป้อนเข้ามา (sanitize user input) เพื่อป้องกันการโจมตีแบบ Cross-Site Scripting (XSS) โดยจะสร้างองค์ประกอบ `div` ชั่วคราว กำหนด `textContent` ของมันเป็นสตริงที่ป้อนเข้ามา จากนั้นส่งคืน `innerHTML` ของมัน ซึ่งเป็นการหลีกเลี่ยง (escape) เอนทิตี HTML อย่างมีประสิทธิภาพ (อย่างไรก็ตาม ในโค้ดที่ให้มา ฟังก์ชันนี้ถูกประกาศไว้แต่ไม่ได้ถูกเรียกใช้งาน)

4.  **ฟังก์ชัน `displayComments`**: ฟังก์ชันนี้รับอาร์เรย์ของอ็อบเจกต์ความคิดเห็น และแสดงผลใน `commentsContainer` โดยจะล้างความคิดเห็นที่มีอยู่เดิม จากนั้นวนซ้ำผ่านอาร์เรย์ สร้าง `div` ใหม่สำหรับความคิดเห็นแต่ละรายการ ใส่ชื่อผู้เขียนและข้อความความคิดเห็นลงไป และเพิ่มลงในคอนเทนเนอร์

5.  **ฟังก์ชัน `fetchComments`**: ฟังก์ชัน asynchronous นี้จะดึงความคิดเห็นจาก JSON Server ที่ทำงานอยู่ที่ `http://localhost:3000/comments` โดยใช้ `fetch` API เพื่อทำการร้องขอแบบ GET แยกวิเคราะห์การตอบกลับที่เป็น JSON จากนั้นเรียกใช้ `displayComments` เพื่อแสดงผลความคิดเห็น และมีการจัดการข้อผิดพลาด (error handling) ด้วย

6.  **ตัวจัดการการส่งฟอร์มความคิดเห็น (Comment Form Submission Handler)**: ตัวฟังเหตุการณ์นี้จะทำงานเมื่อมีการส่งฟอร์มความคิดเห็น
    *   มันจะป้องกันพฤติกรรมการส่งฟอร์มเริ่มต้น
    *   มันจะสร้างอ็อบเจกต์ `newComment` จากค่าที่ป้อนเข้ามา
    *   มันจะทำการตรวจสอบความถูกต้องเบื้องต้นเพื่อให้แน่ใจว่ามีการระบุทั้งชื่อและความคิดเห็น
    *   มันจะส่ง `newComment` ไปยัง JSON Server โดยใช้การร้องขอแบบ POST ไปยัง `http://localhost:3000/comments`
    *   หลังจากส่งสำเร็จ มันจะล้างช่องป้อนข้อมูลและเรียกใช้ `fetchComments` เพื่อรีเฟรชความคิดเห็นที่แสดงอยู่
    *   มันมีการจัดการข้อผิดพลาดสำหรับการร้องขอแบบ POST ด้วย

7.  **การโหลดความคิดเห็นเริ่มต้น**: `fetchComments()` ถูกเรียกหนึ่งครั้งเมื่อหน้าเว็บโหลดขึ้นมาเพื่อแสดงความคิดเห็นที่มีอยู่

**ข้อสังเกตด้านความปลอดภัย**: โค้ดมีฟังก์ชัน `sanitize` แต่ไม่ได้ถูกนำมาใช้จริงเมื่อแสดงความคิดเห็น ฟังก์ชัน `displayComments` ใช้ `textContent` โดยตรงสำหรับ `authorElement` และ `textElement` ซึ่งโดยทั่วไปแล้วปลอดภัยจากการโจมตี XSS สำหรับการแสดงผลข้อความ อย่างไรก็ตาม ข้อความแสดงความคิดเห็นในโค้ดที่ระบุว่า "โค้ดส่วนนี้มีช่องโหว่" (This part of the code has a vulnerability) อาจบ่งชี้ว่ามีความตั้งใจที่จะใช้ `innerHTML` โดยไม่มีการทำความสะอาดที่เหมาะสมในบางจุด หรือเป็นคำใบ้สำหรับช่องโหว่ที่อาจเกิดขึ้นหากไม่ได้ใช้ฟังก์ชัน `sanitize` ในกรณีที่มีการใช้ `innerHTML` จริงๆ ในโค้ดที่ให้มา ฟังก์ชัน `sanitize` ถูกกำหนดไว้แต่ไม่ได้ถูกเรียกใช้งาน